<!doctype html>
  <head>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="webgazer.js" type="text/javascript"></script>
    <style>
      body,html {
        width:100%;
        height:100%;
        margin: 0;
      }
      #game {
        width:100%;
        height:100%;
        z-index: 999999;
      }
      #gamepos {
        width: 50px;
        height: 50px;
        background-color: pink;
        display: block;
        position: fixed;

      }
    </style>
  </head>
  <body>
    <canvas id="game">
    </canvas>
    <div id="gamepos"></div>
  </body>

  <script>
    $().ready(function(){
      x = 0
      y = 0
      cnv = document.getElementById("game");
      ctx = cnv.getContext("2d");
      ctx.fillStyle = "#FFC0CB";

      f = webgazer.setGazeListener(function(data, elapsedTime) {
        if (data == null) {
            return;
        }
        var xprediction = data.x; //these x coordinates are relative to the viewport
        var yprediction = data.y; //these y coordinates are relative to the viewport
        return [x, y]
      }).begin();

      var queuex = [];
      var queuey = [];

      function mean(arr) {
        if(arr.length < 1) {
          return 0;
        }
        return arr.reduce((a, b) => a +b) / arr.length;
      }

      $("#webgazerGazeDot").ready(function(){
        setInterval(function(){
          var OF = $("#webgazerGazeDot").offset();

          queuex.push(OF.left);
          if(queuex.length > 50) {
            queuex.shift();
          }
          queuey.push(OF.top);
          if(queuey.length > 50) {
            queuey.shift();
          }
        }, 10);
      });

      setInterval(function() {
        xbar = mean(queuex);
        ybar = mean(queuey);
        $("#gamepos").offset({top:ybar, left:xbar});
        console.log(xbar, ybar);
      }, 50)
    });
  </script>
</html>
